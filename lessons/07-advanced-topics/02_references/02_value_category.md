# Понятие value category

## Предыстория

Еще в языке Си существовало понятие lvalue и rvalue. Хотя можно подумать, что понятие имеют отношение к значениям, но на самом деле больше связаны с выражениями. В Си принято считать, что lvalue - это выражение, которое может находиться слева от оператора присваивания, а rvalue - справа. Такое определение не совсем корректно, так как упрощает понимание и искажает суть. Стандарт C89 определяет lvalue как "object locator", или другими словами - это выражение, которое имеет адрес в памяти. Rvalue же - это любое выражение, которое не является lvalue. В Си++11 эти понятия были переосмыслены и получили более точные определения.

## Value category

В Си++11 с введением rvalue-ссылок было введено понятие value category. Value category - это классификация выражений на основе их свойств. В языке Си++11 выделено пять категорий выражений, из которых три являются основными:

- lvalue
- xvalue (expiring value)
- prvalue (pure rvalue)
- glvalue (generalized lvalue)
- rvalue

В основе новой классификации легли следующие два свойства выражений:

- Идентичность объекта (object identity) - это свойство, которое определяет, является ли выражение ссылкой на объект или самим объектом.
- Переносимость значения (value transfer) - это свойство, которое определяет, возможно ли семанитика перемещения.

### Lvalue

lvalue - это выражение, которое имеет идентичность объекта. Это означает, что lvalue - это выражение, которое ссылается на объект в памяти. Lvalue можно назвать glvalue, которое не является xvalue.

Следующие выражения являются lvalue:

- Имя переменной, функции, поля структуры или класса
- Функция, возвращающая lvalue-ссылку
- Результат некоторых операций (префиксный инкремент, присваивание, разыменование указателя, индексирование массива и т.д.)
- Строковые литералы

Свойства lvalue:

- Те же, что и у glvalue
- Можно взять адрес (можно применять оператор взятия адреса `&`)
- Если тип lvalue не является константным, то его можно изменить (можно применять оператор присваивания `=`, инкремент `++`, декремент `--` и т.д.)
- Можно использовать для инициализации lvalue-ссылок

### Xvalue

xvalue (expiring value) - это выражение, которое имеет идентичность объекта и переносимость значения. Это означает, что xvalue - это выражение, которое ссылается на объект в памяти, но его значение можно переместить.

Следующие выражения являются xvalue:

- Функция, возвращающая rvalue-ссылку (например, `std::move`)
- Если obj - rvalue, а mem - нестатическое поле класса, то `obj.mem` - xvalue

Свойства xvalue:

- Те же, что и у glvalue
- Те же, что и у rvalue

### Prvalue

prvalue (pure rvalue) - это выражение, которое не имеет идентичности объекта и переносимости значения. Это означает, что prvalue - это выражение, которое не ссылается на объект в памяти и его значение нельзя переместить. Prvalue можно назвать rvalue, которое не является xvalue.

Следующие выражения являются prvalue:

- Литералы (числовые, символьные, логические, nullptr)
- Вызов функции, возвращающая не ссылку (значение)
- Результат некоторых операций (постфиксный инкремент, арифметические операции, логические операции и т.д.)

Свойства prvalue:

- Те же, что и у rvalue
- Не может быть полиморфным (динамическое связывание не применяется)
- Не может быть использовано для инициализации lvalue-ссылок (кроме константной lvalue-ссылки)

### Glvalue

glvalue (generalized lvalue) - это выражение, которое имеет идентичность объекта. Это означает, что glvalue - это выражение, которое ссылается на объект в памяти. Glvalue - это обобщенное понятие, которое объединяет lvalue и xvalue.

Свойства glvalue:

- Может быть полиморфным (динамическое связывание применяется)
- Может быть неполным типом (классы, объявленные, но не определенные, массивы неопределенного размера и т.д.)

### Rvalue

Общее понятие, объединяющее prvalue и xvalue. Это означает, что rvalue - это выражение, которое не имеет идентичности объекта и может быть перемещено.

Свойства rvalue:

- Нельзя взять адрес (нельзя применять оператор взятия адреса `&`)
- Не может находиться слева от оператора присваивания
- Может быть использовано для инициализации константных lvalue-ссылок или rvalue-ссылок. Это продлевает жизнь временного объекта до конца жизни ссылки.

Более подробно о value category и списке операций, которые могут быть применены к выражениям каждой категории, можно прочитать [здесь](https://en.cppreference.com/w/cpp/language/value_category).