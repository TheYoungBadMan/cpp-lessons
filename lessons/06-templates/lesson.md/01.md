# Шаблоны в С++

## Основные понятия

Шаблоны в C++ - это механизм, позволяющий создавать универсальные классы и функции, которые могут работать с любыми типами данных. Как и функции, шаблоны могут принимать параметры, но в отличие от функций, которые могут принимать только значения или ссылки, параметры шаблона могут быть типами данных, фиксированными значениями или другими шаблонами.

В С++ шаблонами могут быть:

- функции
- классы
- методы классов
- переменные (начиная с С++14)

## Шаблоны функций

Чтобы создать шаблон функции, нужно использовать ключевое слово `template` и указать параметры шаблона в угловых скобках перед объявлением функции. Параметры шаблона могут быть типами данных, фиксированными значениями или другими шаблонами.

```cpp
template <typename T>
T max(T a, T b) {
    return a > b ? a : b;
}
```

В данном примере `T` - это параметр шаблона, `typename` - ключевое слово, указывающее, что параметр шаблона является типом данных. Функция `max` принимает два параметра типа `T` и возвращает максимальное из них.

Чтобы использовать шаблон функции, нужно указать тип данных в угловых скобках перед именем шаблононной функции:

```cpp
int a = 5, b = 10;
std::cout << max<int>(a, b) << std::endl; // 10
```

## Параметры шаблона

Параметры шаблона могут быть следующих видов:

- типы данных (например, `typename T` или `class T`)
- фиксированные значения (например, `int N`)
- другие шаблоны (например, `template <typename> class Container`)

Параметры шаблона могут быть нескольких видов одновременно:

```cpp
template <typename T, int N, template <typename> class Container>
void print(const Container<T>& c) {
    for (int i = 0; i < N; ++i) {
        std::cout << c[i] << " ";
    }
    std::cout << std::endl;
}

std::vector<int> v = {1, 2, 3, 4, 5};
print<int, 5, std::vector>(v); // 1 2 3 4 5
```

Имена параметров шаблона могут быть не указаны, если они не используются в теле шаблона:

```cpp
template <typename, int>
void foo() {
    std::cout << "foo" << std::endl;
}

foo<int, 5>(); // foo
```

Это повторяет синтаксис объявления функции, где имена параметров могут быть опущены, если они не используются. Такое поведение удобно, если параметры шаблона не используются в теле шаблона, но нужны для удовлетворения общего интерфейса.

## Значения по умолчанию

Как и параметры функции, параметры шаблона могут иметь значения по умолчанию. В таком случае, при вызове шаблона функции можно не указывать значения параметров, и они будут взяты по умолчанию:

```cpp
template <typename T = int>
T add(T a, T b) {
    return a + b;
}

std::cout << add(5, 10) << std::endl; // 15
```

Если параметр шаблона есть тип данных, то его значением по умолчанию может быть любой тип данных, который имеет конструктор по умолчанию. Для фиксированных значений параметров шаблона значение по умолчанию должно быть константным выражением. Для параметров-шаблонов значение по умолчанию может быть любым шаблоном, который удовлетворяет требованиям параметра.

```cpp
template <typename T = int, int N = 5, template <typename> class Container = std::vector>
void print(const Container<T>& c) {
    for (int i = 0; i < N; ++i) {
        std::cout << c[i] << " ";
    }
    std::cout << std::endl;
}

std::vector<int> v = {1, 2, 3, 4, 5};
print(v); // 1 2 3 4 5
```

Параметры по умолчанию, как и в случае с функциями, должны быть указаны после всех обязательных параметров.

## Неявное выведение типов

В примерах выше типы данных шаблонов указывались явно. В отдельных случаях компилятор может вывести типы данных шаблонов неявно, если они могут быть выведены из контекста:

```cpp
template <typename T>
T add(T a, T b) {
	return a + b;
}

std::cout << add(5, 10) << std::endl; // 15
```

В данном примере компилятор выведет тип данных шаблона `T` из типов данных параметров функции `add`.

Приведем пример, когда компилятор не может вывести типы данных шаблонов неявно:

```cpp
template <typename T>
T max(T a, T b) {
    return a > b ? a : b;
}

std::cout << max(5, 10.0) << std::endl; // error: no matching function for call to 'max(int, double)'
```

В данном примере компилятор не может вывести тип данных шаблона `T`, так как типы данных параметров функции `max` различны.

## Компиляция шаблонов

Важно понимать, что шаблон - сущность этапа компиляции. При анализе шаблона компилятор не генерирует код, а лишь проверяет корректность синтаксиса. Код шаблона генерируется только при вызове шаблона с конкретными параметрами. Это означает, что код будет сгенерирован для каждого вызова шаблона с разными параметрами:

```cpp
template <typename T>
T add(T a, T b) {
    return a + b;
}

add<int>(1, 2)
add<double>(1.0, 2.0);
```
